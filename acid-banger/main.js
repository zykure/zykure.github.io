(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return Math.floor(Math.random()*(e-.01))}function n(e){return e[t(e.length)]}e.d({},{p:()=>k,J:()=>E});var a=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function c(e){try{u(a.next(e))}catch(e){r(e)}}function i(e){try{u(a.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}u((a=a.apply(e,t||[])).next())}))};const o=new Map,r=new Map;function c(e){const t=e.substring(e.length-1),n=e.substring(0,e.length-1);return 12*parseInt(t)+o.get(n)+12}function i(e){return 440*Math.pow(2,(e-69)/12)}function u(e=new(window.AudioContext||window.webkitAudioContext)){function t(){if(e.createConstantSource)return e.createConstantSource();{const t=e.createBufferSource();t.buffer=e.createBuffer(1,256,e.sampleRate);const n=t.buffer.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=1;const a=e.createGain(),o=a.gain;return t.loop=!0,t.connect(a),Object.assign(a,{offset:o,start:()=>t.start()})}}function n(e=50,t=20){const n=new Float32Array(256),a=Math.PI/180;for(let o=0;o<256;++o){const r=2*o/256-1;n[o]=(3+e)*r*t*a/(Math.PI+e*Math.abs(r))}return n}const o=function(){const t=e.createGain();t.gain.value=.5;const n=e.createDynamicsCompressor();n.attack.value=.005,n.release.value=.1,n.ratio.value=15,n.knee.value=0,n.threshold.value=-.5;const a=e.createAnalyser();return a.fftSize=2048,n.connect(a),t.connect(n),n.connect(e.destination),{in:t,analyser:a}}();function r(e){return new Promise((t=>{setTimeout((()=>t()),1e3*e)}))}function u(t,n,c,i,u=0,s=o.in){return a(this,void 0,void 0,(function*(){const a=e.createOscillator();a.type="sawtooth",a.frequency.value=t,a.start();const o=e.createBiquadFilter();o.type="lowpass",o.frequency.value=4*t,o.Q.value=5;const l=e.createGain();l.gain.value=0;const d=e.createPanner();d.panningModel="equalpower",d.setPosition(u,0,1-Math.abs(u)),a.connect(o),o.connect(l),l.connect(d),d.connect(s),l.gain.linearRampToValueAtTime(.1,e.currentTime+n),yield r(c+n),l.gain.setValueAtTime(.1,e.currentTime),l.gain.linearRampToValueAtTime(0,e.currentTime+i),o.frequency.linearRampToValueAtTime(Math.max(t/2,400),e.currentTime+i),yield r(i+.01),a.stop(e.currentTime),d.disconnect()}))}function s(t){return a(this,void 0,void 0,(function*(){const n=yield function(t){return a(this,void 0,void 0,(function*(){const n=yield fetch(t),a=yield n.arrayBuffer();var o;return yield(o=a,new Promise(((t,n)=>e.decodeAudioData(o,t,n))))}))}(t);return{play:function(t=.4,a=1,r=o.in){const c=e.createBufferSource();c.buffer=n,c.loop=!1;const i=e.createGain();i.gain.setValueAtTime(t,e.currentTime),i.gain.linearRampToValueAtTime(0,e.currentTime+a),c.connect(i),i.connect(r),c.start(e.currentTime)}}}))}return{tone:u,SimpleToneSynth:function(e,t,n,a=o.in){return{play:function(o){u(function(e){return i("number"==typeof e?e:c(e))}(o),e,t,n,2*Math.random()-1,a)}}},DelayInsert:function(t,n,a,r=o.in){const c=e.createDelay(1);c.delayTime.value=t;const i=e.createGain();i.gain.value=n,c.connect(i),i.connect(c);const u=e.createGain();u.gain.value=a,c.connect(u),u.connect(r);const s=e.createGain();return s.gain.value=1,s.connect(c),s.connect(r),{in:s,feedback:i.gain,wet:u.gain,delayTime:c.delayTime}},ThreeOh:function(a="sawtooth",r=o.in){const u=e.createBiquadFilter();u.type="lowpass",u.Q.value=20,u.frequency.value=300;const s=u.Q,l=u.frequency,d=t();d.start();const m=d.offset,f=t();f.start(),f.offset.value=0;const v=e.createGain();v.gain.value=0;const p=v.gain,g=e.createWaveShaper();let h=p.value;g.curve=n(h),g.oversample="4x";const b=e.createGain();b.gain.value=4e3;const y=b.gain;f.connect(b),b.connect(u.detune);const w=e.createOscillator();w.type=a,w.frequency.value=440,w.start();const M=e.createGain();return M.gain.value=0,w.connect(M),M.connect(u),u.connect(g),g.connect(r),{noteOn:function(t,a=!1,o=!1){a?(f.offset.cancelScheduledValues(e.currentTime),f.offset.setValueAtTime(1,e.currentTime),f.offset.exponentialRampToValueAtTime(.01,e.currentTime+m.value/3)):(f.offset.cancelScheduledValues(e.currentTime),f.offset.setValueAtTime(1,e.currentTime),f.offset.exponentialRampToValueAtTime(.01,e.currentTime+m.value)),w.frequency.cancelScheduledValues(e.currentTime),w.frequency.setTargetAtTime(i(c(t)),e.currentTime,o?.02:.002),M.gain.cancelScheduledValues(e.currentTime),M.gain.setValueAtTime(a?.2:.15,e.currentTime),M.gain.linearRampToValueAtTime(.1,e.currentTime+.2),p.value!=h&&(h=p.value,g.curve=n(h))},noteOff:function(){M.gain.cancelScheduledValues(e.currentTime),M.gain.setTargetAtTime(0,e.currentTime,.01)},params:{cutoff:l,resonance:s,envMod:y,decay:m,distortion:p}}},kick:function(t=o.in){const n=e.createOscillator();n.frequency.value=400;const a=e.createGain();a.gain.value=.3,n.start(),n.frequency.exponentialRampToValueAtTime(50,e.currentTime+.04),a.gain.setValueCurveAtTime([.5,.5,.45,.4,.25,0],e.currentTime,.09),n.stop(e.currentTime+.1),window.setTimeout((()=>a.disconnect()),200),n.connect(a),a.connect(t)},Sampler:s,SamplerDrumMachine:function(t,n=o.in){return a(this,void 0,void 0,(function*(){const a=e.createGain();a.gain.value=1,a.connect(n);const o=t.map(s);return{triggers:(yield Promise.all(o)).map((e=>({play:t=>e.play(.7*t,.5*t,a)})))}}))},master:o,context:e}}function s(e,t){let n=[];const a={value:t};return{name:e,subscribe:function(e){e(a.value),n.push(e)},get value(){return a.value},set value(e){a.value=e,function(){for(let e of n)e(a.value)}()}}}function l(e,t=!1){return s(e,t)}function d(e,t,n){return Object.assign(s(e,n),{bounds:t})}function m(){let e=s("note set",["C1"]),a=l("new note set",!0);const o=[[0,0,12,24,27],[0,0,0,12,10,19,26,27],[0,1,7,10,12,13],[0],[0,0,0,12],[0,0,12,14,15,19],[0,0,0,0,12,13,16,19,22,24,25],[0,0,0,7,12,15,17,20,24]];return{createPattern:function(){1==a.value&&(function(){const a=t(15)+16,c=n(o);e.value=c.map((e=>function(e){const t=Math.floor(e/12),n=Math.floor(e%12);return`${r.get(n)}${t}`}(e+a)))}(),a.value=!1);const c=[];for(let t=0;t<16;t++){const a=1*(t%4==0?.6:t%3==0?.5:t%2==0?.3:.1);Math.random()<a?c.push({note:n(e.value),accent:Math.random()<.3,glide:Math.random()<.1}):c.push({note:"-",accent:!1,glide:!1})}return c},newNotes:a,noteSet:e}}function f(e){return e<0?0:e>1?1:e}(()=>{function e(e,t){o.set(e,t),r.set(t,e)}e("A",9),e("A#",10),e("B",11),e("C",0),e("C#",1),e("D",2),e("D#",3),e("E",4),e("F",5),e("F#",6),e("G",7),e("G#",8)})();const v={bg:"#222266",note:"#88aacc",accent:"#AA88CC",glide:"#CCAA88",text:"#CCCCFF",highlight:"rgba(255,255,255,0.2)",grid1:"rgba(255,255,255,0.1)",grid2:"rgba(255,255,255,0.3)",dial:"#AA88CC"};function p(e,...t){const n=Array.isArray(e)?e:Object.keys(e).map((t=>e[t])),a=document.createElement("div");return a.classList.add("params",...t),n.forEach((e=>{const t=function(e,t,n,a="red",o="white"){const r=document.createElement("canvas");r.classList.add("dial");const c=r.width=70,i=r.height=50,u=r.getContext("2d");let s=.5,l=.5,d=0,m=null;function v(){u.clearRect(0,0,c,i);const e=[.8*Math.PI,2.2*Math.PI];u.strokeStyle=a,u.lineWidth=2,u.beginPath(),u.arc(c/2,i/2,20,e[0],e[1]),u.stroke(),u.lineWidth=c/8;const t=e[0]+s*(e[1]-e[0]);if(u.beginPath(),u.arc(c/2,i/2,20,t-.2,t+.2),u.stroke(),d>0){u.strokeStyle="rgba(0,255,0,"+f(d/10)+")",u.lineWidth=c/8;const t=e[0]+s*(e[1]-e[0]);u.beginPath(),u.arc(c/2,i/2,20,t-.2,t+.2),u.stroke()}if(n){u.fillStyle=o,u.font="10px Orbitron";const e=u.measureText(n).width;u.fillText(n,c/2-e/2,i/2+20)}}function p(e){return t[0]+(t[1]-t[0])*e}function g(e){var n;s=(e-t[0])/(t[1]-t[0]),v(),Math.abs(s-l)>.002&&(n=4+Math.floor(Math.abs(s-l)/.001),m&&window.clearInterval(m),d=Math.min(n,10),m=window.setInterval((()=>{d--,v()}),100)),l=s}const h={isDragging:!1,handler:[e=>{}]};return r.addEventListener("dblclick",(t=>{const n=e;g(n),h.handler.forEach((e=>e(n)))})),r.addEventListener("mousedown",(e=>{h.isDragging=!0})),window.addEventListener("mousemove",(e=>{if(h.isDragging){const t=(e.movementX-e.movementY)/100;s=f(s+t);const n=p(s);g(n),h.handler.forEach((e=>e(n)))}})),window.addEventListener("mouseup",(e=>{h.isDragging=!1})),v(),{element:r,get value(){return p(s)},set value(e){g(e)},bind:function(e){h.handler.push(e)}}}(e.value,e.bounds,e.name,v.dial,v.text);t.bind((t=>{e.value=t})),e.subscribe((e=>t.value=e)),a.append(t.element)})),a}function g(e,t,n,a,o,...r){const c=Array.isArray(o)?o:Object.keys(o).map((e=>o[e])),i=document.createElement("div");i.classList.add("midi-controls","params",...r);const u=y(e,t);i.append(u);const s=y(n,a);return i.append(s),c.forEach((e=>{const t=document.createElement("span");t.classList.add("param-name"),t.append(document.createTextNode(e.name+":")),i.append(t);const n=function(e,t,n){const a=document.createElement("input");a.classList.add("range");let o=.5,r=.5;function c(e){return t[0]+(t[1]-t[0])*e}function i(e){o=(e-t[0])/(t[1]-t[0]),a.value=u().toString(),r=o}function u(){return Math.trunc(c(o))}a.type="number",a.value=u().toString(),a.min=t[0].toString(),a.max=t[1].toString();const s={isDragging:!1,handler:[e=>{}]};return a.addEventListener("change",(e=>{const t=+a.value;i(t),s.handler.forEach((e=>e(t)))})),a.addEventListener("dblclick",(t=>{const n=e;i(n),s.handler.forEach((e=>e(n)))})),a.addEventListener("mousedown",(e=>{s.isDragging=!0})),window.addEventListener("mousemove",(e=>{if(s.isDragging){const t=(e.movementX-e.movementY)/100;o=f(o+t);const n=c(o);i(n),s.handler.forEach((e=>e(n)))}})),window.addEventListener("mouseup",(e=>{s.isDragging=!1})),{element:a,get value(){return u()},set value(e){i(e)},bind:function(e){s.handler.push(e)}}}(e.value,e.bounds,e.name);n.bind((t=>{e.value=t})),e.subscribe((e=>n.value=e)),i.append(n.element)})),i}function h(e){const t=document.createElement("button");return t.classList.add("trigger-button"),t.innerText="âŸ³",e.subscribe((e=>{e?t.classList.add("waiting"):t.classList.remove("waiting")})),t.addEventListener("click",(function(){e.value=!0})),t}function b(e,...t){const n=document.createElement("button");return n.classList.add(...t),n.innerText=e.name,n.addEventListener("click",(()=>e.value=!e.value)),e.subscribe((e=>{e?(n.classList.add("on"),n.classList.remove("off")):(n.classList.add("off"),n.classList.remove("on"))})),n}function y(e,t){const n=document.createElement("select");n.classList.add("option-list"),n.addEventListener("click",(()=>e.value=n.selectedIndex));for(let e of t){var a=document.createElement("option");a.text=e,n.add(a)}return n}function w(e){const t=document.createElement("div");return t.classList.add("label"),t.innerText=e,t}function M(...e){const t=document.createElement("div");return t.classList.add("machine"),t.append(...e),t}function T(e,t,...n){const a=document.createElement("div");return a.classList.add("control-group",...n),a.append(e,t),a}function D(...e){const t=document.createElement("div");return t.classList.add("group"),t.append(...e),t}var C=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function c(e){try{u(a.next(e))}catch(e){r(e)}}function i(e){try{u(a.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}u((a=a.apply(e,t||[])).next())}))};const k=new Map([["(Default)",{volume:63,offset:0,trigger:-1,cutoff:-1,resonance:-1,envMod:-1,decay:-1,distortion:-1}],["minilogue xd (VCO1)",{volume:63,offset:0,trigger:39,cutoff:43,resonance:44,envMod:22,decay:17,distortion:-1}],["minilogue xd (VCO2)",{volume:63,offset:0,trigger:40,cutoff:43,resonance:44,envMod:22,decay:17,distortion:-1}]]),E=new Map([["(Default)",{volume:63,trigger:-1,pitchBD:-12,pitchOH:-2,pitchCH:-4,pitchSD:-10,pitchCP:-9}]]);function P(e,t,n,a,o,r,c=16){const i=e.ThreeOh(n,a),u=d("Device",[0,1/0],0),m=d("Preset",[0,1/0],0),f=s("Pattern",[]),v=l("New Pattern Trigger",!0),p={cutoff:d("Cutoff",[30,700],400),resonance:d("Resonance",[1,30],15),envMod:d("Env Mod",[0,8e3],4e3),decay:d("Decay",[.1,.9],.5),distortion:d("Dist",[0,80],0)},g={volume:d("Volume",[0,127],63),offset:d("Pitch",[-48,48],0),trigger:d("Trig CC",[-1,127],-1),cutoff:d("Cutoff CC",[-1,127],-1),resonance:d("Reso CC",[-1,127],-1),envMod:d("EnvMod CC",[-1,127],-1),decay:d("Decay CC",[-1,127],-1),distortion:d("Dist CC",[-1,127],-1)};if(r.newNotes.subscribe((e=>{1==e&&(v.value=!0)})),p.cutoff.subscribe((e=>i.params.cutoff.value=e)),p.resonance.subscribe((e=>i.params.resonance.value=e)),p.envMod.subscribe((e=>i.params.envMod.value=e)),p.decay.subscribe((e=>i.params.decay.value=e)),p.distortion.subscribe((e=>i.params.distortion.value=e)),t){function h(e,n){var a=Math.trunc((e.value-e.bounds[0])/(e.bounds[1]-e.bounds[0])*127);t&&n.value>=0&&t.OutputDevice(u.value).controlChange(n.value,a)}u.subscribe((e=>{var n=t.getOutput(e);if(n){var a=n.manufacturer+" "+n.name;console.log("MIDI output device: "+a),t.OutputDevice(u.value).allNotesOff()}})),m.subscribe((e=>{var t=Array.from(k.keys())[m.value];console.log("MIDI control preset: "+t);var n=k.get(t);n&&(g.volume.value=n.volume,g.trigger.value=n.trigger,g.cutoff.value=n.cutoff,g.resonance.value=n.resonance,g.decay.value=n.decay,g.envMod.value=n.envMod,g.distortion.value=n.distortion)})),p.cutoff.subscribe((e=>h(p.cutoff,g.cutoff))),p.resonance.subscribe((e=>h(p.resonance,g.resonance))),p.envMod.subscribe((e=>h(p.envMod,g.envMod))),p.decay.subscribe((e=>h(p.decay,g.decay))),p.distortion.subscribe((e=>h(p.distortion,g.distortion)))}return{step:function(e){(0===e&&1==v.value||0==f.value.length)&&(f.value=r.createPattern(),v.value=!1);const n=f.value[e%c];"-"!=n.note?(i.noteOn(n.note,n.accent,n.glide),t&&(t.OutputDevice(u.value).controlChange(g.trigger.value,g.volume.value),t.OutputDevice(u.value).noteOn(n.note,n.accent,n.glide,g.offset.value))):(i.noteOff(),t&&t.OutputDevice(u.value).controlChange(g.trigger.value,0))},pattern:f,parameters:p,midiDevice:u,midiPreset:m,midiControls:g,newPattern:v}}function A(e,t,a){return C(this,void 0,void 0,(function*(){const a=yield e.SamplerDrumMachine(["samples/bd01.mp4","samples/oh01.mp4","samples/hh01.mp4","samples/sd02.mp4","samples/cp01.mp4"]),o=d("MIDI Device",[0,1/0],0),r=d("Preset",[0,1/0],0),c=s("Drum Pattern",[]),i=[s("Mute BD",!1),s("Mute OH",!1),s("Mute CH",!1),s("Mute SD",!1),s("Mute CP",!1)],u=[d("BD Pitch",[-48,48],0),d("OH Pitch",[-48,48],0),d("CH Pitch",[-48,48],0),d("SD Pitch",[-48,48],0),d("CP Pitch",[-48,48],0)],m={volume:d("Volume",[0,127],63),trigger:d("Trigger CC",[-1,127],-1),pitchBD:u[0],pitchOH:u[1],pitchCH:u[2],pitchSD:u[3],pitchCP:u[4]},f=l("New Pattern Trigger",!0),v=function(e=!1){const t=new Array(16),a=new Array(16),o=new Array(16),r=new Array(16),c=new Array(16),i=n(["electro","fourfloor"]),u=n(["offbeats","closed",e?"offbeats":"none"]),s=n(["backbeat","skip",e?"backbeat":"none"]),l=n(["backbeat","skip",e?"backbeat":"none"]);if("fourfloor"==i)for(let e=0;e<16;e++)e%4==0?t[e]=.9:e%2==0&&Math.random()<.1&&(t[e]=.6);else if("electro"==i)for(let e=0;e<16;e++)0==e?t[e]=1:(e%2==0&&e%8!=4&&Math.random()<.5||Math.random()<.05)&&(t[e]=.9*Math.random());if("backbeat"==s)for(let e=0;e<16;e++)e%8==4&&(r[e]=1);else if("skip"==s)for(let e=0;e<16;e++)e%8==3||e%8==6?r[e]=.6+.4*Math.random():e%2==0&&Math.random()<.2?r[e]=.4+.2*Math.random():Math.random()<.1&&(r[e]=.2+.2*Math.random());if("backbeat"==l)for(let e=0;e<16;e++)e%8==4?c[e]=.5:e%8==5&&r[e-1]&&(c[e]=.3+.2*Math.random());else if("skip"==l)for(let e=0;e<16;e++)e%8==3||e%8==6?c[e]=.5+.3*Math.random():(e%8==4||e%8==7)&&c[e-1]&&Math.random()<.5?c[e]=.3+.2*Math.random():e%2==0&&Math.random()<(r[e]?.2:.4)?c[e]=.4+.1*Math.random():Math.random()<.1&&(c[e]=.1+.1*Math.random());if("offbeats"==u)for(let e=0;e<16;e++)e%4==2?a[e]=.4:Math.random()<.3&&(Math.random()<.5?o[e]=.2+.2*Math.random():a[e]=.1+.2*Math.random());else if("closed"==u)for(let e=0;e<16;e++)e%2==0?o[e]=.4:Math.random()<.5&&(o[e]=.2+.3*Math.random());return[t,a,o,r,c]};return t&&(o.subscribe((e=>{var n=t.getOutput(e);n&&(console.log("MIDI output device: "+n.manufacturer+" "+n.name),t.OutputDevice(o.value).allNotesOff())})),r.subscribe((e=>{var t=Array.from(E.keys())[r.value];console.log("MIDI control preset: "+t);var n=E.get(t);n&&(m.volume.value=n.volume,m.trigger.value=n.trigger,m.pitchBD.value=n.pitchBD,m.pitchOH.value=n.pitchOH,m.pitchCH.value=n.pitchCH,m.pitchSD.value=n.pitchSD,m.pitchCP.value=n.pitchCP)}))),{step:function(e){(0==e&&1==f.value||0==c.value.length)&&(c.value=v(!0),f.value=!1);var n=!1;for(let r in c.value){const s=c.value[r][e%c.value[r].length];s&&!i[r].value&&(a.triggers[r].play(s),n=!0,t)&&(t.OutputDevice(o.value).controlChange(m.trigger.value,m.volume.value),t.OutputDevice(o.value).noteOn(u[r].value,!1,!1))}t&&(n||t.OutputDevice(o.value).controlChange(m.trigger.value,0))},pattern:c,mutes:i,midiDevice:o,midiPreset:r,midiControls:m,newPattern:f}}))}var S=null;try{window.navigator.requestMIDIAccess().then((e=>{console.log("MIDI Ready!"),(S=function(e,t=100){function n(t){if("number"==typeof t){if(0==t)return null;var n=Array.from(e.outputs.keys())[t-1];return e.outputs.get(n)}return e.outputs.get(t)}return{noteLength:t,listInputsAndOutputs:function(){for(var t of e.inputs){var n=t[1];console.log("Input port [type:'"+n.type+"'] id:'"+n.id+"' manufacturer:'"+n.manufacturer+"' name:'"+n.name+"' version:'"+n.version+"'")}for(var t of e.outputs){var a=t[1];console.log("Output port [type:'"+a.type+"'] id:'"+a.id+"' manufacturer:'"+a.manufacturer+"' name:'"+a.name+"' version:'"+a.version+"'")}},getOutputNames:function(){var t=[];for(var n of(t.push("(None)"),e.outputs)){var a=n[1];t.push(a.name)}return t},getOutput:n,OutputDevice:function(e){return{noteOn:function(a,o=!1,r=!1,i=0){if(a<0)return;var u="number"==typeof a?a:c(a),s=r?t:t/2;const l=[144,u+=i,o?127:95],d=[128,u,64];var m=n(e);m&&(m.send(l),m.send(d,window.performance.now()+s))},noteOff:function(t,a=0){if(t<0)return;var o="number"==typeof t?t:c(t);const r=[128,o+=a,64];var i=n(e);i&&i.send(r)},allNotesOff:function t(){var a=n(e);a&&a.send(t)},controlChange:function(t,a){if(t<0)return;const o=[176,t,a];var r=n(e);r&&r.send(o)}}},startClock:function t(n){for(var a of e.outputs)a[1].send([248]);window.setTimeout(t,6e4/n.value*(1/24))}}}(e)).listInputsAndOutputs()})).catch((e=>{console.log("Error accessing MIDI devices: "+e)}))}catch(e){console.log("Error accessing MIDI devices: "+e)}!function(e,t,n,a="Click, tap or press any key to start"){const o=document.createElement("button");o.id="_start_button";const r=document.createElement("div");r.id="_intro_text",o.append(r),r.innerHTML=t+"<br><br>"+n+"<br><br>"+a,document.head.insertAdjacentHTML("beforeend",`\n    <style>\n        body {\n            height: 95vh;  margin: 0; padding: 0;\n        }\n        #${o.id} {\n            width: 100%;\n            height: 100%;\n            display: block;\n            position: absolute;\n            top: 0;\n            left: 0;\n            z-index: 50;\n            color:grey;\n            background-color: black;\n        }\n\n        #${r.id} {\n            max-width: 640px;\n            font-size: 1.5em;\n            margin-left: auto;\n            margin-right: auto;\n            text-align:left;\n            font-family: monospace;\n        }\n    </style>\n    `),document.body.append(o);let c=!1;function i(){c||(c=!0,e(),o.style.display="none")}o.addEventListener("click",i),window.addEventListener("keydown",i)}((function(){return C(this,void 0,void 0,(function*(){const e=u(),t=function(){const e=d("BPM",[70,200],142),t=d("Current Step",[0,15],0),n=function(e,t=4,n=0){let a=e,o=(e,t)=>{},r=(new Date).getTime(),c=0;return window.setTimeout((function e(){const i=(new Date).getTime()-r;o(i,c);const u=c%2==0?1+n:1-n;c++,window.setTimeout(e,u*(6e4/a)/t)}),6e4/e/t),{bind:function(e){o=e},setBpm:e=>a=e}}(e.value,4,0);return e.subscribe(n.setBpm),n.bind(((e,n)=>{t.value=n%16})),{bpm:e,currentStep:t}}(),n=function(e){const t=d("Dry/Wet",[0,.5],.5),n=d("Feedback",[0,.9],.3),a=d("Time",[0,2],.3),o=e.DelayInsert(a.value,t.value,n.value);return t.subscribe((e=>o.wet.value=e)),n.subscribe((e=>o.feedback.value=e)),a.subscribe((e=>o.delayTime.value=e)),{dryWet:t,feedback:n,delayTime:a,inputNode:o.in}}(e);t.bpm.subscribe((e=>n.delayTime.value=3/4*(60/e)));const a=m(),o={notes:[P(e,S,"sawtooth",n.inputNode,t.bpm,a),P(e,S,"square",n.inputNode,t.bpm,a)],drums:yield A(e,S,t.bpm),gen:a,delay:n,clock:t,masterVolume:d("Volume",[0,1],.5)};S&&(console.log("MIDI output enabled"),t.bpm.subscribe((e=>S.noteLength=1/4*(6e4/e))),S.startClock(t.bpm)),o.masterVolume.subscribe((t=>{e.master.in.gain.value=t})),t.currentStep.subscribe((e=>[...o.notes,o.drums].forEach((t=>t.step(e)))));const r=function(e){const t=d("upcomingMeasure",[0,1/0],0),n=d("measure",[0,1/0],0),a=s("Alter Patterns",!0),o=s("Twiddle With Knobs",!0),r=s("Mute Drum Parts",!0);var c=[0,0];e.clock.currentStep.subscribe((e=>{4===e?t.value=t.value+1:15===e&&(n.value=n.value+1)})),t.subscribe((t=>{a.value&&(t%64==0&&Math.random()<.2&&(console.log("measure #%d: will generate new notes",t),e.gen.newNotes.value=!0,c[0]=c[1]=t),t%16==0?(e.notes.forEach(((e,n)=>{Math.random()<.5&&(console.log("measure #%d: will generate new pattern for unit %d",t,n),e.newPattern.value=!0,c[n]=t)})),Math.random()<.3&&(console.log("measure #%d: will generate new pattern for drums",t),e.drums.newPattern.value=!0)):t%16==4&&e.notes.every(((e,n)=>{const a=t-c[n];if(a>=20&&Math.random()<.5)return console.log("measure #%d: will generate new pattern for unit %d (age %d)",t,n,a),e.newPattern.value=!0,void(c[n]=t)})))})),n.subscribe((t=>{if(r.value){const n=[Math.random()<.2,Math.random()<.5,Math.random()<.5,Math.random()<.5,Math.random()<.8],a=e.drums.mutes.reduce(((e,t)=>t.value?e:e+1),0);t%8==0?(console.log("measure #%d: may mute drum parts",t),e.drums.mutes.forEach(((e,t)=>{e.value=n[t]}))):t%8==7?(console.log("measure #%d: may mute drum parts",t),e.drums.mutes.forEach(((e,t)=>{Math.random()<.5&&(e.value||(e.value=n[t]))}))):t%2==0&&(console.log("measure #%d: may unmute drum parts",t),e.drums.mutes.forEach(((e,t)=>{Math.random()<1/(a+1)&&e.value&&(e.value=n[t])})))}}));const i=[...e.notes.flatMap((e=>Object.values(e.parameters))),e.delay.feedback,e.delay.dryWet].map((e=>function(e,t=1/400){const[n,a]=e.bounds;let o=0,r=t*(a-n),c=0,i=(n+a)/2;return{step:()=>{i!=e.value?(o=0,i=e.value,c=200):(c>0&&c--,c<100&&(o*=c>0?.8:.98,o+=(Math.random()-.5)*r,e.value+=o,i=e.value,e.value>n+.8*(a-n)?o-=Math.random()*r:e.value<n+.2*(a-n)&&(o+=Math.random()*r)))}}}(e)));return window.setInterval((()=>{o.value&&i.forEach((e=>e.step()))}),100),{switches:[a,o,r]}}(o),i=function(e,t,n,a){const o=document.createElement("div");o.id="ui";const r=function(...e){const t=document.createElement("div");return t.classList.add("controls"),t.append(...e),t}(function(e){return T(w("Autopilot"),D(...e.switches.map((e=>b(e,"autopilot-button")))))}(t),function(e){const t=document.createElement("div");return t.classList.add("parameter-controlled","notegen-note-display"),e.noteSet.subscribe((e=>{t.innerText=e.join(", ")})),T(w("Notegen"),D(h(e.newNotes),t),"notegen-box")}(e.gen),function(e){const t=p([e.dryWet,e.feedback]);return t.classList.add("horizontal"),T(w("Delay"),t)}(e.delay),T(w("Clock"),p([e.clock.bpm],"horizontal")),T(w("Volume"),p([e.masterVolume],"horizontal")),T(w("Meter"),D(function(e){const t=document.createElement("canvas");t.style.width="100%";let n=t.width=200;const a=t.height=50,o=t.getContext("2d"),r=new Uint8Array(e.fftSize),c=new Uint8Array(e.frequencyBinCount/2);return window.requestAnimationFrame((function t(){e.getByteTimeDomainData(r),e.getByteFrequencyData(c),o.clearRect(0,0,n,a),o.fillStyle="white";for(let e=0;e<c.length;e++){const t=c[e]/256;o.fillStyle="rgb("+(c[e]/2+128)+",0,0)",o.fillRect(n*e/c.length,a-1*t*a,n/c.length,1*t*a)}o.strokeStyle="white",o.beginPath(),o.moveTo(0,a/2);for(let e=0;e<r.length;e++){const t=r[e]/128-1;o.lineTo(n*e/r.length,a/2+1.5*t*a/2)}o.stroke(),window.requestAnimationFrame(t)})),t}(n)),"meter")),i=document.createElement("div");i.classList.add("machines");const u=document.createElement("div"),s=a?a.getOutputNames():[],l=[...k.keys()],d=[...E.keys()],m=e.notes.map(((t,n)=>M(w("303-0"+(n+1)),D(h(t.newPattern),function(e,t,n=v){const a=document.createElement("canvas");function o(){const o=e.value,r=a.width=a.clientWidth,i=a.height=200,u=i/50,s=a.getContext("2d");s.font="10px Orbitron",s.fillStyle=n.bg,s.fillRect(0,0,r,i);for(let e=0;e<o.length;e++){s.strokeStyle=e%4==0?n.grid2:n.grid1;const t=r*e/o.length;s.beginPath(),s.moveTo(t,0),s.lineTo(t,i),s.stroke()}for(let e=0;e<80;e++){s.strokeStyle=e%12==0?n.grid2:n.grid1;const t=i-e*u;s.beginPath(),s.moveTo(0,t),s.lineTo(r,t),s.stroke()}for(let e=0;e<o.length;e++){const t=o[e];if("-"===t.note);else{const a=c(t.note)-24,l=r*e/o.length,d=i-a*u,m=r/o.length,f=5;s.fillStyle=t.glide?n.glide:t.accent?n.accent:n.note,s.fillRect(l,d,m,f),s.fillStyle=n.text;const v=l+m/2-s.measureText(t.note).width/2;s.fillText(t.note,v,d)}}s.fillStyle=n.highlight,s.fillRect(r*t.value/o.length,0,r/o.length,i)}return a.classList.add("pattern"),e.subscribe(o),t.subscribe(o),a}(t.pattern,e.clock.currentStep),p(t.parameters),a?g(t.midiDevice,s,t.midiPreset,l,t.midiControls,"horizontal"):u)))),f=M(w("909-XX"),D(h(e.drums.newPattern),function(e,t,n,a=v){const o=document.createElement("canvas");function r(){const r=o.width=o.clientWidth,c=o.height=100,i=o.getContext("2d");i.fillStyle=a.bg,i.fillRect(0,0,r,c);for(let e=0;e<16;e+=4){i.strokeStyle=e%4==0?a.grid2:a.grid1;const t=r*e/16;i.beginPath(),i.moveTo(t,0),i.lineTo(t,c),i.stroke()}for(let n=0;n<16;n++){const a=r*n/16;for(let o=0;o<e.value.length;o++){const u=o/e.value.length*c;e.value[o][n]&&(t[o].value?i.fillStyle="rgba(128,0,0,0.4)":i.fillStyle="rgba(136,170,204,"+e.value[o][n]+")",i.fillRect(a,u,r/16,c/e.value.length))}}i.fillStyle=a.highlight,i.fillRect(r*n.value/16,0,r/16,c)}return o.classList.add("pattern"),e.subscribe(r),n.subscribe(r),o}(e.drums.pattern,e.drums.mutes,e.clock.currentStep),function(e){const t=document.createElement("div");return t.classList.add("mutes"),t.append(...e.map((e=>b(e)))),t}(e.drums.mutes),a?g(e.drums.midiDevice,s,e.drums.midiPreset,d,e.drums.midiControls,"horizontal"):u));return i.append(...m,f),o.append(i,r),o}(o,r,e.master.analyser,S);document.body.append(i)}))}),"Spicy Endless Acid Banger","A collaboration between human and algorithm by Vitling, spiced up by Zykure")})();